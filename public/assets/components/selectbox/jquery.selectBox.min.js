/* jQuery SelectBox - https://github.com/claviska/jquery-selectBox */
jQuery&&function(e){e.extend(e.fn,{selectBox:function(t,n){var r,i="",s=navigator.platform.match(/mac/i),o=function(t,n){var r;if(navigator.userAgent.match(/iPad|iPhone|Android|IEMobile|BlackBerry/i))return!1;if(t.tagName.toLowerCase()!=="select")return!1;t=e(t);if(t.data("selectBox-control"))return!1;var i=e('<a class="selectBox" />'),s=t.attr("multiple")||parseInt(t.attr("size"))>1,o=n||{};i.width(t.outerWidth()).addClass(t.attr("class")).attr("title",t.attr("title")||"").attr("tabindex",parseInt(t.attr("tabindex"))).css("display","inline-block").bind("focus.selectBox",function(){this!==document.activeElement&&document.body!==document.activeElement&&e(document.activeElement).blur();if(i.hasClass("selectBox-active"))return;i.addClass("selectBox-active"),t.trigger("focus")}).bind("blur.selectBox",function(){if(!i.hasClass("selectBox-active"))return;i.removeClass("selectBox-active"),t.trigger("blur")}),e(window).data("selectBox-bindings")||e(window).data("selectBox-bindings",!0).bind("scroll.selectBox",d).bind("resize.selectBox",d),t.attr("disabled")&&i.addClass("selectBox-disabled"),t.bind("click.selectBox",function(e){i.focus(),e.preventDefault()});if(s){r=u(t,"inline"),i.append(r).data("selectBox-options",r).addClass("selectBox-inline selectBox-menuShowing").bind("keydown.selectBox",function(e){b(t,e)}).bind("keypress.selectBox",function(e){w(t,e)}).bind("mousedown.selectBox",function(t){e(t.target).is("A.selectBox-inline")&&t.preventDefault(),i.hasClass("selectBox-focus")||i.focus()}).insertAfter(t);if(!t[0].style.height){var l=t.attr("size")?parseInt(t.attr("size")):5,c=i.clone().removeAttr("id").css({position:"absolute",top:"-9999em"}).show().appendTo("body");c.find(".selectBox-options").html("<li><a> </a></li>");var h=parseInt(c.find(".selectBox-options A:first").html("&nbsp;").outerHeight());c.remove(),i.height(h*l)}N(i)}else{var v=e('<span class="selectBox-label" />'),m=e('<span class="selectBox-arrow" />');v.attr("class",a(t)).text(f(t)),r=u(t,"dropdown"),r.appendTo("BODY"),i.data("selectBox-options",r).addClass("selectBox-dropdown").append(v).append(m).bind("mousedown.selectBox",function(e){i.hasClass("selectBox-menuShowing")?d():(e.stopPropagation(),r.data("selectBox-down-at-x",e.screenX).data("selectBox-down-at-y",e.screenY),p(t))}).bind("keydown.selectBox",function(e){b(t,e)}).bind("keypress.selectBox",function(e){w(t,e)}).bind("open.selectBox",function(e,n){if(n&&n._selectBox===!0)return;p(t)}).bind("close.selectBox",function(e,t){if(t&&t._selectBox===!0)return;d()}).insertAfter(t);var g=i.width()-m.outerWidth()-parseInt(v.css("paddingLeft"))-parseInt(v.css("paddingLeft"));v.width(g),N(i)}t.addClass("selectBox").data("selectBox-control",i).data("selectBox-settings",o).hide()},u=function(t,n){var r,i=function(t,n){return t.children("OPTION, OPTGROUP").each(function(){if(e(this).is("OPTION"))e(this).length>0?C(e(this),n):n.append("<li> </li>");else{var t=e('<li class="selectBox-optgroup" />');t.text(e(this).attr("label")),n.append(t),n=i(e(this),n)}}),n};switch(n){case"inline":return r=e('<ul class="selectBox-options" />'),r=i(t,r),r.find("A").bind("mouseover.selectBox",function(n){m(t,e(this).parent())}).bind("mouseout.selectBox",function(n){g(t,e(this).parent())}).bind("mousedown.selectBox",function(e){e.preventDefault(),t.selectBox("control").hasClass("selectBox-active")||t.selectBox("control").focus()}).bind("mouseup.selectBox",function(n){d(),v(t,e(this).parent(),n)}),N(r),r;case"dropdown":r=e('<ul class="selectBox-dropdown-menu selectBox-options" />'),r=i(t,r),r.data("selectBox-select",t).css("display","none").appendTo("BODY").find("A").bind("mousedown.selectBox",function(e){e.preventDefault(),e.screenX===r.data("selectBox-down-at-x")&&e.screenY===r.data("selectBox-down-at-y")&&(r.removeData("selectBox-down-at-x").removeData("selectBox-down-at-y"),d())}).bind("mouseup.selectBox",function(n){if(n.screenX===r.data("selectBox-down-at-x")&&n.screenY===r.data("selectBox-down-at-y"))return;r.removeData("selectBox-down-at-x").removeData("selectBox-down-at-y"),v(t,e(this).parent()),d()}).bind("mouseover.selectBox",function(n){m(t,e(this).parent())}).bind("mouseout.selectBox",function(n){g(t,e(this).parent())});var s=t.attr("class")||"";if(s!==""){s=s.split(" ");for(var o in s)r.addClass(s[o]+"-selectBox-dropdown-menu")}return N(r),r}},a=function(t){var n=e(t).find("OPTION:selected");return("selectBox-label "+(n.attr("class")||"")).replace(/\s+$/,"")},f=function(t){var n=e(t).find("OPTION:selected");return n.text()||" "},l=function(t){t=e(t);var n=t.data("selectBox-control");if(!n)return;n.find(".selectBox-label").attr("class",a(t)).text(f(t))},c=function(t){t=e(t);var n=t.data("selectBox-control");if(!n)return;var r=n.data("selectBox-options");r.remove(),n.remove(),t.removeClass("selectBox").removeData("selectBox-control").data("selectBox-control",null).removeData("selectBox-settings").data("selectBox-settings",null).show()},h=function(t){t=e(t),t.selectBox("options",t.html())},p=function(t){t=e(t);var n=t.data("selectBox-control"),r=t.data("selectBox-settings"),i=n.data("selectBox-options");if(n.hasClass("selectBox-disabled"))return!1;d();var s=isNaN(n.css("borderBottomWidth"))?0:parseInt(n.css("borderBottomWidth"));i.width(n.innerWidth()).css({top:n.offset().top+n.outerHeight()-s,left:n.offset().left});if(t.triggerHandler("beforeopen"))return!1;var o=function(){t.triggerHandler("open",{_selectBox:!0})};switch(r.menuTransition){case"fade":i.fadeIn(r.menuSpeed,o);break;case"slide":i.slideDown(r.menuSpeed,o);break;default:i.show(r.menuSpeed,o)}r.menuSpeed||o();var u=i.find(".selectBox-selected:first");y(t,u,!0),m(t,u),n.addClass("selectBox-menuShowing"),e(document).bind("mousedown.selectBox",function(t){if(e(t.target).parents().andSelf().hasClass("selectBox-options"))return;d()})},d=function(){if(e(".selectBox-dropdown-menu:visible").length===0)return;e(document).unbind("mousedown.selectBox"),e(".selectBox-dropdown-menu").each(function(){var t=e(this),n=t.data("selectBox-select"),r=n.data("selectBox-control"),i=n.data("selectBox-settings");if(n.triggerHandler("beforeclose"))return!1;var s=function(){n.triggerHandler("close",{_selectBox:!0})};if(i){switch(i.menuTransition){case"fade":t.fadeOut(i.menuSpeed,s);break;case"slide":t.slideUp(i.menuSpeed,s);break;default:t.hide(i.menuSpeed,s)}i.menuSpeed||s(),r.removeClass("selectBox-menuShowing")}else e(this).hide(),e(this).triggerHandler("close",{_selectBox:!0}),e(this).removeClass("selectBox-menuShowing")})},v=function(t,n,r){t=e(t),n=e(n);var i=t.data("selectBox-control"),o=t.data("selectBox-settings");if(i.hasClass("selectBox-disabled"))return!1;if(n.length===0||n.hasClass("selectBox-disabled"))return!1;if(t.attr("multiple"))if(r.shiftKey&&i.data("selectBox-last-selected")){n.toggleClass("selectBox-selected");var u;n.index()>i.data("selectBox-last-selected").index()?u=n.siblings().slice(i.data("selectBox-last-selected").index(),n.index()):u=n.siblings().slice(n.index(),i.data("selectBox-last-selected").index()),u=u.not(".selectBox-optgroup, .selectBox-disabled"),n.hasClass("selectBox-selected")?u.addClass("selectBox-selected"):u.removeClass("selectBox-selected")}else s&&r.metaKey||!s&&r.ctrlKey?n.toggleClass("selectBox-selected"):(n.siblings().removeClass("selectBox-selected"),n.addClass("selectBox-selected"));else n.siblings().removeClass("selectBox-selected"),n.addClass("selectBox-selected");i.hasClass("selectBox-dropdown")&&i.find(".selectBox-label").text(n.text());var a=0,f=[];return t.attr("multiple")?i.find(".selectBox-selected A").each(function(){f[a++]=e(this).attr("rel")}):f=n.find("A").attr("rel"),i.data("selectBox-last-selected",n),t.val()!==f&&(t.val(f),l(t),t.trigger("change")),!0},m=function(t,n){t=e(t),n=e(n);var r=t.data("selectBox-control"),i=r.data("selectBox-options");i.find(".selectBox-hover").removeClass("selectBox-hover"),n.addClass("selectBox-hover")},g=function(t,n){t=e(t),n=e(n);var r=t.data("selectBox-control"),i=r.data("selectBox-options");i.find(".selectBox-hover").removeClass("selectBox-hover")},y=function(t,n,r){if(!n||n.length===0)return;t=e(t);var i=t.data("selectBox-control"),s=i.data("selectBox-options"),o=i.hasClass("selectBox-dropdown")?s:s.parent(),u=parseInt(n.offset().top-o.position().top),a=parseInt(u+n.outerHeight());r?o.scrollTop(n.offset().top-o.offset().top+o.scrollTop()-o.height()/2):(u<0&&o.scrollTop(n.offset().top-o.offset().top+o.scrollTop()),a>o.height()&&o.scrollTop(n.offset().top+n.outerHeight()-o.offset().top+o.scrollTop()-o.height()))},b=function(t,n){t=e(t);var r=t.data("selectBox-control"),s=r.data("selectBox-options"),o=t.data("selectBox-settings"),u=0,a=0;if(r.hasClass("selectBox-disabled"))return;switch(n.keyCode){case 8:n.preventDefault(),i="";break;case 9:case 27:d(),g(t);break;case 13:r.hasClass("selectBox-menuShowing")?(v(t,s.find("LI.selectBox-hover:first"),n),r.hasClass("selectBox-dropdown")&&d()):p(t);break;case 38:case 37:n.preventDefault();if(r.hasClass("selectBox-menuShowing")){var f=s.find(".selectBox-hover").prev("LI");u=s.find("LI:not(.selectBox-optgroup)").length,a=0;while(f.length===0||f.hasClass("selectBox-disabled")||f.hasClass("selectBox-optgroup")){f=f.prev("LI"),f.length===0&&(o.loopOptions?f=s.find("LI:last"):f=s.find("LI:first"));if(++a>=u)break}m(t,f),v(t,f,n),y(t,f)}else p(t);break;case 40:case 39:n.preventDefault();if(r.hasClass("selectBox-menuShowing")){var l=s.find(".selectBox-hover").next("LI");u=s.find("LI:not(.selectBox-optgroup)").length,a=0;while(l.length===0||l.hasClass("selectBox-disabled")||l.hasClass("selectBox-optgroup")){l=l.next("LI"),l.length===0&&(o.loopOptions?l=s.find("LI:first"):l=s.find("LI:last"));if(++a>=u)break}m(t,l),v(t,l,n),y(t,l)}else p(t)}},w=function(t,n){t=e(t);var s=t.data("selectBox-control"),o=s.data("selectBox-options");if(s.hasClass("selectBox-disabled"))return;switch(n.keyCode){case 9:case 27:case 13:case 38:case 37:case 40:case 39:break;default:s.hasClass("selectBox-menuShowing")||p(t),n.preventDefault(),clearTimeout(r),i+=String.fromCharCode(n.charCode||n.keyCode),o.find("A").each(function(){if(e(this).text().substr(0,i.length).toLowerCase()===i.toLowerCase())return m(t,e(this).parent()),y(t,e(this).parent()),!1}),r=setTimeout(function(){i=""},1e3)}},E=function(t){t=e(t),t.attr("disabled",!1);var n=t.data("selectBox-control");if(!n)return;n.removeClass("selectBox-disabled")},S=function(t){t=e(t),t.attr("disabled",!0);var n=t.data("selectBox-control");if(!n)return;n.addClass("selectBox-disabled")},x=function(t,n){t=e(t),t.val(n),n=t.val(),n===null&&(n=t.children().first().val(),t.val(n));var r=t.data("selectBox-control");if(!r)return;var i=t.data("selectBox-settings"),s=r.data("selectBox-options");l(t),s.find(".selectBox-selected").removeClass("selectBox-selected"),s.find("A").each(function(){if(typeof n=="object")for(var t=0;t<n.length;t++)e(this).attr("rel")==n[t]&&e(this).parent().addClass("selectBox-selected");else e(this).attr("rel")==n&&e(this).parent().addClass("selectBox-selected")}),i.change&&i.change.call(t)},T=function(t,r){t=e(t);var i=t.data("selectBox-control"),s=t.data("selectBox-settings");switch(typeof n){case"string":t.html(n);break;case"object":t.html("");for(var o in n){if(n[o]===null)continue;if(typeof n[o]=="object"){var a=e('<optgroup label="'+o+'" />');for(var f in n[o])a.append('<option value="'+f+'">'+n[o][f]+"</option>");t.append(a)}else{var c=e('<option value="'+o+'">'+n[o]+"</option>");t.append(c)}}}if(!i)return;i.data("selectBox-options").remove();var h=i.hasClass("selectBox-dropdown")?"dropdown":"inline";r=u(t,h),i.data("selectBox-options",r);switch(h){case"inline":i.append(r);break;case"dropdown":l(t),e("BODY").append(r)}},N=function(t){e(t).css("MozUserSelect","none").bind("selectstart",function(e){e.preventDefault()})},C=function(t,n){var r=e("<li />"),i=e("<a />");r.addClass(t.attr("class")),r.data(t.data()),i.attr("rel",t.val()).text(t.text()),r.append(i),t.attr("disabled")&&r.addClass("selectBox-disabled"),t.attr("selected")&&r.addClass("selectBox-selected"),n.append(r)};switch(t){case"control":return e(this).data("selectBox-control");case"settings":if(!n)return e(this).data("selectBox-settings");e(this).each(function(){e(this).data("selectBox-settings",e.extend(!0,e(this).data("selectBox-settings"),n))});break;case"options":if(n===undefined)return e(this).data("selectBox-control").data("selectBox-options");e(this).each(function(){T(this,n)});break;case"value":if(n===undefined)return e(this).val();e(this).each(function(){x(this,n)});break;case"refresh":e(this).each(function(){h(this)});break;case"enable":e(this).each(function(){E(this)});break;case"disable":e(this).each(function(){S(this)});break;case"destroy":e(this).each(function(){c(this)});break;default:e(this).each(function(){o(this,t)})}return e(this)}})}(jQuery);