/*
 * simpleWeather
 * 
 * A simple jQuery plugin to display the weather information
 * for a location. Weather is pulled from the public Yahoo!
 * Weather feed via their api.
 *
 * Developed by James Fleeting <hello@jamesfleeting.com>
 * Another project from monkeeCreate <http://monkeecreate.com>
 *
 * Version 2.0.1 - Last updated: January 26 2012
 */
(function(e){"use strict";e.extend({simpleWeather:function(t){t=e.extend({zipcode:"76309",location:"",unit:"f",success:function(e){},error:function(e){}},t);var n=new Date,r="http://query.yahooapis.com/v1/public/yql?format=json&rnd="+n.getFullYear()+n.getMonth()+n.getDay()+n.getHours()+"&diagnostics=true&callback=?&diagnostics=true&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys&q=";if(t.location!=="")r+='select * from weather.forecast where location in (select id from weather.search where query="'+t.location+'") and u="'+t.unit+'"';else{if(t.zipcode==="")return t.error("No location given."),!1;r+='select * from weather.forecast where location in ("'+t.zipcode+'") and u="'+t.unit+'"'}return e.getJSON(r,function(n){n!==null&&n.query.results!==null?e.each(n.query.results,function(e,n){n.constructor.toString().indexOf("Array")!==-1&&(n=n[0]);var r=new Date,i=new Date(r.toDateString()+" "+n.astronomy.sunrise),s=new Date(r.toDateString()+" "+n.astronomy.sunset);if(r>i&&r<s)var o="d";else var o="n";var u=["N","NNE","NE","ENE","E","ESE","SE","SSE","S","SSW","SW","WSW","W","WNW","NW","NNW","N"],a=u[Math.round(n.wind.direction/22.5)];if(n.item.condition.temp<80&&n.atmosphere.humidity<40)var f=-42.379+2.04901523*n.item.condition.temp+10.14333127*n.atmosphere.humidity-.22475541*n.item.condition.temp*n.atmosphere.humidity-6.83783*Math.pow(10,-3)*Math.pow(n.item.condition.temp,2)-5.481717*Math.pow(10,-2)*Math.pow(n.atmosphere.humidity,2)+1.22874*Math.pow(10,-3)*Math.pow(n.item.condition.temp,2)*n.atmosphere.humidity+8.5282*Math.pow(10,-4)*n.item.condition.temp*Math.pow(n.atmosphere.humidity,2)-1.99*Math.pow(10,-6)*Math.pow(n.item.condition.temp,2)*Math.pow(n.atmosphere.humidity,2);else var f=n.item.condition.temp;if(t.unit==="f")var l=Math.round(5/9*(n.item.condition.temp-32));else var l=Math.round(1.8*n.item.condition.temp+32);var c={title:n.item.title,temp:n.item.condition.temp,tempAlt:l,code:n.item.condition.code,todayCode:n.item.forecast[0].code,units:{temp:n.units.temperature,distance:n.units.distance,pressure:n.units.pressure,speed:n.units.speed},currently:n.item.condition.text,high:n.item.forecast[0].high,low:n.item.forecast[0].low,forecast:n.item.forecast[0].text,wind:{chill:n.wind.chill,direction:a,speed:n.wind.speed},humidity:n.atmosphere.humidity,heatindex:f,pressure:n.atmosphere.pressure,rising:n.atmosphere.rising,visibility:n.atmosphere.visibility,sunrise:n.astronomy.sunrise,sunset:n.astronomy.sunset,description:n.item.description,thumbnail:"http://l.yimg.com/a/i/us/nws/weather/gr/"+n.item.condition.code+o+"s.png",image:"http://l.yimg.com/a/i/us/nws/weather/gr/"+n.item.condition.code+o+".png",tomorrow:{high:n.item.forecast[1].high,low:n.item.forecast[1].low,forecast:n.item.forecast[1].text,code:n.item.forecast[1].code,date:n.item.forecast[1].date,day:n.item.forecast[1].day,image:"http://l.yimg.com/a/i/us/nws/weather/gr/"+n.item.forecast[1].code+"d.png"},city:n.location.city,country:n.location.country,region:n.location.region,updated:n.item.pubDate,link:n.item.link};t.success(c)}):n.query.results===null?t.error("Invalid location given."):t.error("Weather could not be displayed. Try again.")}),this}})})(jQuery);