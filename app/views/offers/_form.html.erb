<%= form_for @offer, :remote => true do |form| %>
  <%= modal_body do %>
    <p><%= i18n_legend_for(@offer) %></p>
    <%= form.error_messages %>

    <%= form.control_group :quest_id,     :hidden_field %>
    <%= form.control_group :title,        :text_area, :rows => 2 %>
    <%= form.control_group :description,  :text_area, :rows => 5 %>
    <%#= form.control_group :location %>
    <%= form.control_group :images,       :filepicker %>

    <% if @offer.criteria.present? %>
      <p><%= i18n_form_hint_for(@offer, :count => @offer.quest.criteria.size) %></p>
      <%= form.control_group :compliance, :compliance %>

      <ol class="criteria_compliances">
        <% @offer.criteria.each_with_index do |criterium, idx| %>
          <li>
            <p><%= "#{idx +1 })" %> <strong><%= criterium[:title] %></strong></p>
            <%= form.control_group Offer.criteria_ids[idx], :hidden_field %>
            <%= form.control_group Offer.criteria_compliances[idx], :range_slider,  :label => Offer.human_attribute_name(:fulfillment), :hint => false %>
            <%= form.control_group Offer.criteria_comments[idx],    :text_field,    :label => Offer.human_attribute_name(:comment),     :hint => false %>
          </li>
        <% end %>
      </ol>
    <% end %>
  <% end %>
  
  <%= modal_footer do %>
    <%= form.actions "#", :"data-dismiss" => "modal" %>
  <% end %>

<% end %>


<script type="text/javascript" charset="utf-8">
// recalculate compliance, whenever a compliance changed.
  jQuery("input[type=range]").change(function() {
    var form    = $(this).closest("form");
    var bar     = jQuery("div.progress div.bar", form)[0];
    var sliders = jQuery("input[type=range]", form);
    var sum     = 0;

    sliders.each(function() { sum += parseInt($(this).val()); });
    var compliance = Math.round(sliders.length > 0 ? (sum * 100) / (10 * sliders.length) : 50);
    
    bar.innerHTML = compliance;
    bar.setAttribute('style', 'width:' + compliance + '%');
  });
</script>
