<% accordion_heading(:email) do %>
  <%= I18n.t("identity/email.form.title")%>
  <%= awesome_icon(:icon_envelope_alt, :class => "pull-right") %>
<% end %>

<% accordion_body(:email, :default => true) do %>
  <%= form_for @identity ||= Identity::Email.new, :url => "/signin", :remote => true do |form| %>
    <p><%= I18n.t("identity/email.form.legend")%></p>

    <%= hidden_field_tag :req, params[:req] %>
    <%= form.error_messages @error if @error %>

    <%= form.control_group :email,    :text_field %>
    <%= form.control_group :password, :password_field %>
    <%= form.forgot_password %>

    <div class="buttons">
      <%= link_to_cancel_signin %>
      <%= form.submit I18n.t("button.signin"),  :name => "do_signin", :id => "do_signin", :class => "btn btn-primary btn-inverse" %>
      <%= form.submit I18n.t("button.reset"),   :name => "do_reset",  :id => "do_reset",  :class => "btn btn-primary btn-inverse hide" %>
    </div>
  <% end %>
<% end %>

<script type="text/javascript" charset="utf-8">
  $("#forgot_password").change(function() {
    if($(this).is(':checked')){
      $("#identity_password").attr("disabled", "disabled");
      $("input[name=do_signin]").toggleClass('hide');
      $("input[name=do_reset]").toggleClass('hide');
    }
    else {
      $("#identity_password").removeAttr("disabled");
      $("input[name=do_signin]").toggleClass('hide');
      $("input[name=do_reset]").toggleClass('hide');
    }
  });
  <% if @mode.to_sym == :reset %>
    $("#forgot_password").trigger('click')
  <% end %>
</script>
