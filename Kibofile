# This is an example Kibofile. Use with kibo(1) to configure
# remote instances.
heroku:
  # The email of the heroku account to create app instances on heroku.
  account: deployment@bountyhill.com

  # Our instances will be called 'bountyhill-staging-web0', 'bountyhill-production-worker0', etc.
  namespace: bountyhill

processes:
  web: 1

# Commands to run in the deployment arena; i.e. when the deployment branch
# is checked out.
arena:
  pre:
    - git rm -r --force --quiet public/assets || true
    - rake assets:rebuild
    - kibo compress --quiet public/assets
    - git add -f public/assets
    - "git commit -m '[kibo] Updated assets'"
  skip-success:
    - heroku run rake db:migrate
source:
  pre:
    - rake bountybase:release
    - rm -rf tmp/assets
    - mv public/assets tmp/assets || true
  success:
    - git tag $ENVIRONMENT-$(date "+%Y.%m.%d-%H.%M")
  final:
    - rm -rf public/assets
    - mv tmp/assets public/assets || true
