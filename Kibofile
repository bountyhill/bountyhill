version: "0.4.3"

# This is an example Kibofile. Use with kibo(1) to configure
# remote instances.
heroku:
  # The email of the heroku account to create app instances on heroku.
  account: deployment@bountyhill.com

  # Our instances will be called 'bountyhill-staging-web0', 'bountyhill-production-worker0', etc.
  namespace: bountyhill

processes:
  web: 1

#heroku:
  
sharing:
  - eno@open-lab.org

# The live settings overwrite other settings for the "live" environment.
live:
  processes:
    web: 1
  heroku:
    mode: pro
  addons:
    web1:
      - pgbackups:auto-month
      - neo4j:test
      - sendgrid:starter
      - openredis:micro
      - heroku-postgresql:basic

# Commands to run in the deployment arena; i.e. when the deployment branch
# is checked out.
arena:
  pre:
    - git rm -r --force --quiet public/assets || true
    - rake assets:rebuild
    - kibo compress --quiet public/assets
    - git add -f public/assets
    - "git commit -m '[kibo] Updated assets'"
source:
  pre:
    - rake bountybase:release
    - rm -rf tmp/assets
    - mv public/assets tmp/assets || true
  success:
    - kibo per_role $ENVIRONMENT run rake db:migrate
    - git tag $ENVIRONMENT-$(date "+%Y.%m.%d-%H.%M")
  final:
    - rm -rf public/assets
    - mv tmp/assets public/assets || true
